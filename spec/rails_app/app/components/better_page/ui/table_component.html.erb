<div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-lg"
     <% if selectable? %>data-controller="table"<% end %>>
  <% if items? %>
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-50">
        <tr>
          <% if selectable? %>
            <th scope="col" class="relative px-6 py-3">
              <input type="checkbox"
                     class="absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                     data-table-target="selectAll"
                     data-action="change->table#selectAll">
            </th>
          <% end %>
          <% columns.each do |column| %>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider <%= column[:class] %>">
              <%= column[:label] %>
            </th>
          <% end %>
          <% if row_actions? %>
            <th scope="col" class="relative px-6 py-3">
              <span class="sr-only">Actions</span>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <% items.each do |item| %>
          <tr class="<%= row_link? ? 'hover:bg-gray-50 cursor-pointer' : 'hover:bg-gray-50' %>"
              <% if row_link? %>
                data-turbo-frame="_top"
                onclick="Turbo.visit('<%= link_for(item) %>')"
              <% end %>>
            <% if selectable? %>
              <td class="relative px-6 py-4" onclick="event.stopPropagation()">
                <input type="checkbox"
                       class="absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                       value="<%= item_id(item) %>"
                       data-table-target="row"
                       data-action="change->table#rowChanged">
              </td>
            <% end %>
            <% columns.each do |column| %>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 <%= column[:cell_class] %>">
                <%= format_value(item, column) %>
              </td>
            <% end %>
            <% if row_actions? %>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium" onclick="event.stopPropagation()">
                <% if dropdown_actions? %>
                  <div data-controller="dropdown" class="relative inline-block text-left">
                    <button type="button"
                            data-action="click->dropdown#toggle"
                            class="p-2 rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                      <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                      </svg>
                      <span class="sr-only">Open options</span>
                    </button>

                    <div data-dropdown-target="menu"
                         class="hidden w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50">
                      <div class="py-1" role="menu">
                        <% actions_for(item).each do |action| %>
                          <%= link_to action[:path],
                              data: { turbo_method: action[:method], turbo_confirm: action[:confirm] }.compact,
                              class: action_dropdown_class(action[:style]),
                              role: "menuitem" do %>
                            <%= action[:label] %>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% else %>
                  <div class="flex justify-end space-x-2">
                    <% actions_for(item).each do |action| %>
                      <%= link_to action[:path],
                          data: { turbo_method: action[:method], turbo_confirm: action[:confirm] }.compact,
                          class: action_link_class(action[:style]) do %>
                        <%= action[:label] %>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%# Footer slot per paginazione e altri dati %>
    <% if footer? %>
      <div class="border-t border-gray-300 bg-white px-6 py-4">
        <%= footer %>
      </div>
    <% end %>
  <% elsif empty_state? %>
    <div class="text-center py-12">
      <% if empty_state[:icon] %>
        <div class="mx-auto h-12 w-12 text-gray-400">
          <%= empty_state[:icon] %>
        </div>
      <% end %>
      <h3 class="mt-2 text-sm font-medium text-gray-900"><%= empty_state[:title] %></h3>
      <% if empty_state[:description] %>
        <p class="mt-1 text-sm text-gray-500"><%= empty_state[:description] %></p>
      <% end %>
      <% if empty_state[:action] %>
        <%= link_to empty_state[:action][:path],
            data: { turbo_frame: "_top" },
            class: "mt-4 inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
          <%= empty_state[:action][:label] %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
