<div class="overflow-hidden rounded-lg bg-white shadow ring-1 ring-black ring-opacity-5">
  <div class="grid grid-cols-8 border-b border-gray-200">
    <div class="border-r border-gray-200 py-3 text-center text-xs font-semibold text-gray-500"></div>
    <% days_of_week.each do |day| %>
      <div class="py-3 text-center <%= day[:is_today] ? 'bg-blue-50' : '' %>">
        <span class="text-xs font-semibold text-gray-500"><%= day[:name] %></span>
        <span class="mt-1 flex items-center justify-center">
          <span class="<%= day[:is_today] ? 'flex h-8 w-8 items-center justify-center rounded-full bg-blue-600 text-sm font-semibold text-white' : 'text-sm font-semibold text-gray-900' %>">
            <%= day[:day] %>
          </span>
        </span>
      </div>
    <% end %>
  </div>

  <div class="grid grid-cols-8">
    <% visible_hours.each do |hour| %>
      <div class="border-r border-b border-gray-200 py-2 text-right pr-2">
        <span class="text-xs text-gray-500"><%= format('%02d:00', hour) %></span>
      </div>
      <% days_of_week.each do |day| %>
        <%
          cell_events = day[:events].select do |e|
            event_time = e[:start_time] || e[:time]
            next false unless event_time
            event_hour = event_time.respond_to?(:hour) ? event_time.hour : event_time.to_s.split(':').first.to_i
            event_hour == hour
          end
        %>
        <div class="relative border-b border-gray-200 min-h-[60px] <%= day[:is_today] ? 'bg-blue-50/50' : '' %>">
          <% cell_events.each do |event| %>
            <div class="absolute inset-x-0 mx-1 mt-1 rounded bg-blue-100 px-2 py-1 text-xs">
              <p class="font-medium text-blue-700 truncate"><%= event[:title] || event[:name] %></p>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
